const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Pagination-Nsp6pIGA.js","assets/index-sGzm-zv8.js","assets/index-DQt1lWaP.css"])))=>i.map(i=>d[i]);
import{b as E,a as S,r as a,I as P,j as e,J as w,R as z,_ as D,K as A,s as F}from"./index-sGzm-zv8.js";import{S as v,I as _}from"./Icons-DCsXMgab.js";const L=z.lazy(()=>D(()=>import("./Pagination-Nsp6pIGA.js"),__vite__mapDeps([0,1,2])));function T({productId:c}){const l=E(),{loggedInUser:o}=S(s=>s.users),{reviews:n,totalPages:h,totalReviews:u}=S(s=>s.reviews),[t,r]=a.useState(null),[m,g]=a.useState(0),[j,p]=a.useState(""),[d,k]=a.useState(1),[b,f]=a.useState(!1);a.useEffect(()=>{c&&l(P({productId:c,pageNum:d,limit:5}))},[c,d,l]),a.useEffect(()=>{t&&(g(t.rating),p(t.comment))},[t]);const C=async s=>{s.preventDefault(),f(!0);try{await l(A({reviewId:t._id,rating:m,comment:j})).unwrap(),r(null)}catch(i){l(F(i||"Failed to update review"))}finally{f(!1)}},N=()=>{r(null)};return e.jsxs(e.Fragment,{children:[(n==null?void 0:n.length)>0?e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h4",{className:"d-flex align-items-center gap-2 mb-0 pb-0",children:["Customer Reviews",e.jsxs("span",{className:"badge rounded-pill text-white px-3 py-2 d-flex align-items-center gap-1",style:{background:"linear-gradient(45deg, #007bff, #00c6ff)"},children:[e.jsx(v,{size:25,color:"gold",fill:"gold"})," ",u]})]}),e.jsxs("small",{className:"text-muted",children:["Page ",d," of ",h," (",u," reviews)"]})]}),n.map(s=>{var i,y,R;return e.jsx("div",{className:"card mb-3 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{src:(i=s==null?void 0:s.author)==null?void 0:i.avatar,loading:"lazy",className:"rounded-circle",width:30,height:30,alt:"User avatar"}),e.jsx("h6",{className:"card-subtitle mb-2 mt-2 text-muted flex-fill",children:((y=s==null?void 0:s.author)==null?void 0:y.name)||"Author name"}),((R=s==null?void 0:s.author)==null?void 0:R._id)===(o==null?void 0:o._id)&&e.jsxs("div",{className:"dropdown float-end",children:[e.jsx("button",{className:"btn btn-sm",type:"button","data-bs-toggle":"dropdown","aria-label":"Review options","aria-expanded":"false",children:e.jsx(_,{name:"ThreeDots",size:20})}),e.jsxs("ul",{className:"dropdown-menu dropdown-menu-end",children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:()=>r(s),children:"✏️ Update"})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item text-danger",onClick:()=>l(w(s._id)),children:"🗑️ Delete"})})]})]})]}),e.jsx("div",{className:"mb-2",children:[1,2,3,4,5].map(x=>e.jsx(v,{size:20,color:x<=s.rating?"gold":"lightgray",fill:x<=s.rating?"gold":"none"},x))}),e.jsx("p",{className:"card-text",children:s.comment}),e.jsx("small",{className:"text-muted",children:s.createdAt?new Date(s.createdAt).toLocaleString():"Unknown date"})]})},s==null?void 0:s._id)}),e.jsx(a.Suspense,{fallback:"Loading...",children:e.jsx(L,{page:d,setPage:k,totalPages:h})})]}):e.jsx("p",{className:"text-muted",children:"No reviews yet. Be the first to review!"}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Edit Review"}),e.jsx("button",{type:"button",className:"btn-close",onClick:N})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:[1,2,3,4,5].map(s=>e.jsx(_,{name:"Star",size:30,role:"button","aria-label":`Rate ${s} star${s>1?"s":""}`,color:s<=m?"gold":"lightgray",fill:s<=m?"gold":"none",style:{cursor:"pointer"},onClick:()=>g(s)},s))}),e.jsx("textarea",{className:"form-control",value:j,onChange:s=>p(s.target.value),required:!0})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:b,children:b?"Saving...":"Update Review"})]})]})})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})]})}export{T as default};
